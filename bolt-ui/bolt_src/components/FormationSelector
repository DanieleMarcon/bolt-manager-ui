<div class="formation-selector">
  <div class="selector-header">
    <h4 class="selector-title">Formazione</h4>
    <div class="selector-actions">
      <button class="action-btn preview-btn" aria-label="Anteprima formazione">
        üëÅÔ∏è Anteprima
      </button>
    </div>
  </div>
  
  <div class="formations-grid">
    <label class="formation-option">
      <input type="radio" name="formation" value="4-4-2" checked aria-label="Formazione 4-4-2">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 20%"></div>
            <div class="player-dot" style="top: 70%; left: 40%"></div>
            <div class="player-dot" style="top: 70%; left: 60%"></div>
            <div class="player-dot" style="top: 70%; left: 80%"></div>
            <div class="player-dot" style="top: 45%; left: 20%"></div>
            <div class="player-dot" style="top: 45%; left: 40%"></div>
            <div class="player-dot" style="top: 45%; left: 60%"></div>
            <div class="player-dot" style="top: 45%; left: 80%"></div>
            <div class="player-dot" style="top: 20%; left: 35%"></div>
            <div class="player-dot" style="top: 20%; left: 65%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">4-4-2</span>
          <span class="formation-description">Equilibrata</span>
        </div>
      </div>
    </label>
    
    <label class="formation-option">
      <input type="radio" name="formation" value="4-3-3" aria-label="Formazione 4-3-3">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 20%"></div>
            <div class="player-dot" style="top: 70%; left: 40%"></div>
            <div class="player-dot" style="top: 70%; left: 60%"></div>
            <div class="player-dot" style="top: 70%; left: 80%"></div>
            <div class="player-dot" style="top: 45%; left: 30%"></div>
            <div class="player-dot" style="top: 45%; left: 50%"></div>
            <div class="player-dot" style="top: 45%; left: 70%"></div>
            <div class="player-dot" style="top: 20%; left: 25%"></div>
            <div class="player-dot" style="top: 20%; left: 50%"></div>
            <div class="player-dot" style="top: 20%; left: 75%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">4-3-3</span>
          <span class="formation-description">Offensiva</span>
        </div>
      </div>
    </label>
    
    <label class="formation-option">
      <input type="radio" name="formation" value="3-5-2" aria-label="Formazione 3-5-2">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 30%"></div>
            <div class="player-dot" style="top: 70%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 70%"></div>
            <div class="player-dot" style="top: 45%; left: 15%"></div>
            <div class="player-dot" style="top: 45%; left: 30%"></div>
            <div class="player-dot" style="top: 45%; left: 50%"></div>
            <div class="player-dot" style="top: 45%; left: 70%"></div>
            <div class="player-dot" style="top: 45%; left: 85%"></div>
            <div class="player-dot" style="top: 20%; left: 35%"></div>
            <div class="player-dot" style="top: 20%; left: 65%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">3-5-2</span>
          <span class="formation-description">Centrocampo forte</span>
        </div>
      </div>
    </label>
    
    <label class="formation-option">
      <input type="radio" name="formation" value="4-2-3-1" aria-label="Formazione 4-2-3-1">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 20%"></div>
            <div class="player-dot" style="top: 70%; left: 40%"></div>
            <div class="player-dot" style="top: 70%; left: 60%"></div>
            <div class="player-dot" style="top: 70%; left: 80%"></div>
            <div class="player-dot" style="top: 50%; left: 35%"></div>
            <div class="player-dot" style="top: 50%; left: 65%"></div>
            <div class="player-dot" style="top: 30%; left: 25%"></div>
            <div class="player-dot" style="top: 30%; left: 50%"></div>
            <div class="player-dot" style="top: 30%; left: 75%"></div>
            <div class="player-dot" style="top: 15%; left: 50%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">4-2-3-1</span>
          <span class="formation-description">Moderna</span>
        </div>
      </div>
    </label>
    
    <label class="formation-option">
      <input type="radio" name="formation" value="5-3-2" aria-label="Formazione 5-3-2">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 10%"></div>
            <div class="player-dot" style="top: 70%; left: 30%"></div>
            <div class="player-dot" style="top: 70%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 70%"></div>
            <div class="player-dot" style="top: 70%; left: 90%"></div>
            <div class="player-dot" style="top: 45%; left: 30%"></div>
            <div class="player-dot" style="top: 45%; left: 50%"></div>
            <div class="player-dot" style="top: 45%; left: 70%"></div>
            <div class="player-dot" style="top: 20%; left: 35%"></div>
            <div class="player-dot" style="top: 20%; left: 65%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">5-3-2</span>
          <span class="formation-description">Difensiva</span>
        </div>
      </div>
    </label>
    
    <label class="formation-option">
      <input type="radio" name="formation" value="4-1-2-1-2" aria-label="Formazione 4-1-2-1-2">
      <div class="option-content">
        <div class="formation-preview">
          <div class="formation-field">
            <div class="player-dot" style="top: 90%; left: 50%"></div>
            <div class="player-dot" style="top: 70%; left: 20%"></div>
            <div class="player-dot" style="top: 70%; left: 40%"></div>
            <div class="player-dot" style="top: 70%; left: 60%"></div>
            <div class="player-dot" style="top: 70%; left: 80%"></div>
            <div class="player-dot" style="top: 55%; left: 50%"></div>
            <div class="player-dot" style="top: 40%; left: 30%"></div>
            <div class="player-dot" style="top: 40%; left: 70%"></div>
            <div class="player-dot" style="top: 25%; left: 50%"></div>
            <div class="player-dot" style="top: 15%; left: 35%"></div>
            <div class="player-dot" style="top: 15%; left: 65%"></div>
          </div>
        </div>
        <div class="formation-info">
          <span class="formation-name">4-1-2-1-2</span>
          <span class="formation-description">Diamante</span>
        </div>
      </div>
    </label>
  </div>
  
  <div class="formation-details">
    <div class="details-section">
      <h5>Caratteristiche Formazione</h5>
      <div class="formation-stats">
        <div class="stat-item">
          <span class="stat-label">Difesa</span>
          <div class="stat-bar">
            <div class="stat-fill defense-fill"></div>
          </div>
        </div>
        
        <div class="stat-item">
          <span class="stat-label">Centrocampo</span>
          <div class="stat-bar">
            <div class="stat-fill midfield-fill"></div>
          </div>
        </div>
        
        <div class="stat-item">
          <span class="stat-label">Attacco</span>
          <div class="stat-bar">
            <div class="stat-fill attack-fill"></div>
          </div>
        </div>
        
        <div class="stat-item">
          <span class="stat-label">Ampiezza</span>
          <div class="stat-bar">
            <div class="stat-fill width-fill"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="details-section">
      <h5>Consigli Tattici</h5>
      <div class="tactical-advice">
        <div class="advice-icon">üìã</div>
        <div class="advice-content">
          <p class="advice-text">Questa formazione √® equilibrata e si adatta bene a diversi stili di gioco. Assicurati di avere centrocampisti con buona resistenza per coprire entrambe le fasi.</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="formation-actions">
    <button class="button button-primary apply-formation-btn">
      Applica Formazione
    </button>
  </div>
</div>

<style>
.formation-selector {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}

.selector-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.selector-title {
  font-size: 18px;
  font-weight: 600;
  margin: 0;
  color: var(--text);
}

.selector-actions {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 6px 12px;
  background: var(--background);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.action-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.formations-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.formation-option {
  cursor: pointer;
}

.formation-option input[type="radio"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.option-content {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  background: var(--background);
  border: 2px solid var(--border);
  border-radius: 8px;
  transition: all 0.2s ease;
}

.formation-option input[type="radio"]:checked + .option-content {
  border-color: var(--primary);
  background: rgba(37, 99, 235, 0.05);
}

.formation-option input[type="radio"]:focus + .option-content {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

.formation-preview {
  position: relative;
  height: 120px;
  margin-bottom: 8px;
}

.formation-field {
  position: absolute;
  inset: 0;
  background: #2d5a27;
  border-radius: 4px;
  overflow: hidden;
}

.formation-field::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: rgba(255, 255, 255, 0.3);
}

.formation-field::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.player-dot {
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

.formation-info {
  text-align: center;
}

.formation-name {
  display: block;
  font-size: 16px;
  font-weight: 600;
  color: var(--text);
}

.formation-description {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
}

.formation-details {
  background: var(--background);
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
}

.details-section {
  margin-bottom: 16px;
}

.details-section:last-child {
  margin-bottom: 0;
}

.details-section h5 {
  font-size: 14px;
  font-weight: 600;
  margin: 0 0 12px 0;
  color: var(--text);
}

.formation-stats {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 12px;
}

.stat-label {
  font-size: 12px;
  color: var(--text-muted);
  min-width: 80px;
  font-weight: 500;
}

.stat-bar {
  flex: 1;
  height: 8px;
  background: var(--border);
  border-radius: 4px;
  overflow: hidden;
}

.stat-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.8s ease;
}

.defense-fill {
  background: linear-gradient(90deg, #3b82f6, #2563eb);
  width: 75%;
}

.midfield-fill {
  background: linear-gradient(90deg, #10b981, #059669);
  width: 80%;
}

.attack-fill {
  background: linear-gradient(90deg, #ef4444, #dc2626);
  width: 70%;
}

.width-fill {
  background: linear-gradient(90deg, #f59e0b, #d97706);
  width: 65%;
}

.tactical-advice {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px;
  background: var(--surface);
  border-radius: 6px;
  border-left: 3px solid var(--primary);
}

.advice-icon {
  font-size: 18px;
  flex-shrink: 0;
}

.advice-content {
  flex: 1;
}

.advice-text {
  font-size: 12px;
  color: var(--text);
  line-height: 1.5;
  margin: 0;
}

.formation-actions {
  display: flex;
  justify-content: flex-end;
}

.button {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.button-primary {
  background: var(--primary);
  border: 1px solid var(--primary);
  color: white;
}

.button-primary:hover {
  background: var(--primary-dark);
}

/* Responsive */
@media (max-width: 1024px) {
  .formations-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .selector-header {
    flex-direction: column;
    gap: 12px;
    align-items: flex-start;
  }
  
  .formations-grid {
    grid-template-columns: 1fr;
  }
  
  .formation-actions {
    justify-content: center;
  }
  
  .button {
    width: 100%;
  }
}
</style>

<script>
class FormationSelector {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      onChange: null,
      defaultFormation: '4-4-2',
      ...options
    };
    
    this.currentFormation = this.options.defaultFormation;
    this.formations = {
      '4-4-2': {
        name: '4-4-2',
        description: 'Equilibrata',
        stats: {
          defense: 75,
          midfield: 80,
          attack: 70,
          width: 65
        },
        advice: 'Questa formazione √® equilibrata e si adatta bene a diversi stili di gioco. Assicurati di avere centrocampisti con buona resistenza per coprire entrambe le fasi.'
      },
      '4-3-3': {
        name: '4-3-3',
        description: 'Offensiva',
        stats: {
          defense: 65,
          midfield: 70,
          attack: 85,
          width: 80
        },
        advice: 'Formazione offensiva che sfrutta l\'ampiezza. Ideale per squadre con esterni veloci e tecnici. Attenzione alla copertura difensiva.'
      },
      '3-5-2': {
        name: '3-5-2',
        description: 'Centrocampo forte',
        stats: {
          defense: 70,
          midfield: 85,
          attack: 75,
          width: 60
        },
        advice: 'Ottima per dominare il centrocampo. Richiede difensori centrali affidabili e centrocampisti con buona resistenza per coprire le fasce.'
      },
      '4-2-3-1': {
        name: '4-2-3-1',
        description: 'Moderna',
        stats: {
          defense: 75,
          midfield: 75,
          attack: 75,
          width: 70
        },
        advice: 'Formazione versatile e moderna. Il trequartista centrale √® fondamentale per collegare centrocampo e attacco. Buon equilibrio tra fase offensiva e difensiva.'
      },
      '5-3-2': {
        name: '5-3-2',
        description: 'Difensiva',
        stats: {
          defense: 90,
          midfield: 70,
          attack: 60,
          width: 50
        },
        advice: 'Formazione molto solida difensivamente. Ideale contro avversari pi√π forti. I terzini devono supportare la fase offensiva quando possibile.'
      },
      '4-1-2-1-2': {
        name: '4-1-2-1-2',
        description: 'Diamante',
        stats: {
          defense: 70,
          midfield: 85,
          attack: 80,
          width: 55
        },
        advice: 'Formazione a diamante che privilegia il gioco centrale. Richiede terzini con buona spinta offensiva per garantire ampiezza. Il mediano davanti alla difesa √® fondamentale.'
      }
    };
    
    this.init();
  }
  
  init() {
    this.loadFormation();
    this.bindEvents();
  }
  
  loadFormation() {
    // In a real app, this would load from localStorage or game state
    try {
      const savedFormation = localStorage.getItem('bolt_formation');
      if (savedFormation) {
        this.currentFormation = savedFormation;
      }
      
      // Update UI
      this.element.querySelector(`input[name="formation"][value="${this.currentFormation}"]`).checked = true;
      this.updateFormationDetails();
    } catch (error) {
      console.error('Error loading formation:', error);
    }
  }
  
  bindEvents() {
    // Formation radio buttons
    this.element.querySelectorAll('input[name="formation"]').forEach(radio => {
      radio.addEventListener('change', () => {
        this.currentFormation = radio.value;
        this.updateFormationDetails();
      });
    });
    
    // Preview button
    this.element.querySelector('.preview-btn').addEventListener('click', () => {
      this.previewFormation();
    });
    
    // Apply button
    this.element.querySelector('.apply-formation-btn').addEventListener('click', () => {
      this.applyFormation();
    });
  }
  
  updateFormationDetails() {
    const formation = this.formations[this.currentFormation];
    if (!formation) return;
    
    // Update stats
    this.element.querySelector('.defense-fill').style.width = `${formation.stats.defense}%`;
    this.element.querySelector('.midfield-fill').style.width = `${formation.stats.midfield}%`;
    this.element.querySelector('.attack-fill').style.width = `${formation.stats.attack}%`;
    this.element.querySelector('.width-fill').style.width = `${formation.stats.width}%`;
    
    // Update advice
    this.element.querySelector('.advice-text').textContent = formation.advice;
  }
  
  previewFormation() {
    // Dispatch preview event
    this.element.dispatchEvent(new CustomEvent('formationPreview', {
      detail: { 
        formation: this.currentFormation,
        formationData: this.formations[this.currentFormation]
      }
    }));
    
    this.showSuccess('Anteprima formazione attivata');
  }
  
  applyFormation() {
    // Save formation
    localStorage.setItem('bolt_formation', this.currentFormation);
    
    // Call onChange callback if provided
    if (typeof this.options.onChange === 'function') {
      this.options.onChange(this.currentFormation, this.formations[this.currentFormation]);
    }
    
    // Dispatch formation change event
    this.element.dispatchEvent(new CustomEvent('formationChange', {
      detail: { 
        formation: this.currentFormation,
        formationData: this.formations[this.currentFormation]
      }
    }));
    
    this.showSuccess(`Formazione ${this.currentFormation} applicata`);
  }
  
  showSuccess(message) {
    window.dispatchEvent(new CustomEvent('showToast', {
      detail: { message, type: 'success' }
    }));
  }
  
  // Public methods
  getCurrentFormation() {
    return this.currentFormation;
  }
  
  getFormationData() {
    return this.formations[this.currentFormation];
  }
  
  setFormation(formation) {
    if (this.formations[formation]) {
      this.currentFormation = formation;
      this.element.querySelector(`input[name="formation"][value="${formation}"]`).checked = true;
      this.updateFormationDetails();
    }
  }
  
  getAllFormations() {
    return Object.keys(this.formations);
  }
}

// Auto-initialize formation selectors
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.formation-selector').forEach(selector => {
    if (!selector.dataset.initialized) {
      const options = JSON.parse(selector.dataset.options || '{}');
      new FormationSelector(selector, options);
      selector.dataset.initialized = 'true';
    }
  });
});
</script>