<div class="gameplay-settings">
  <div class="settings-header">
    <h4 class="settings-title">Impostazioni Gameplay</h4>
    <div class="settings-actions">
      <button class="action-btn reset-btn" aria-label="Reimposta impostazioni">
        ↻ Reset
      </button>
    </div>
  </div>
  
  <div class="settings-content">
    <div class="settings-section">
      <h5>Difficoltà e Sfida</h5>
      <div class="setting-group">
        <div class="setting-item">
          <div class="setting-info">
            <label for="gameDifficulty" class="setting-label">Livello Difficoltà</label>
            <span class="setting-description">Imposta la difficoltà generale del gioco</span>
          </div>
          <div class="setting-control">
            <select id="gameDifficulty" class="setting-select">
              <option value="beginner">Principiante</option>
              <option value="easy">Facile</option>
              <option value="normal" selected>Normale</option>
              <option value="hard">Difficile</option>
              <option value="expert">Esperto</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="aiDifficulty" class="setting-label">Intelligenza AI</label>
            <span class="setting-description">Livello di intelligenza delle squadre avversarie</span>
          </div>
          <div class="setting-control">
            <select id="aiDifficulty" class="setting-select">
              <option value="basic">Base</option>
              <option value="standard" selected>Standard</option>
              <option value="advanced">Avanzata</option>
              <option value="master">Master</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="injuryFrequency" class="setting-label">Frequenza Infortuni</label>
            <span class="setting-description">Frequenza con cui i giocatori si infortunano</span>
          </div>
          <div class="setting-control">
            <select id="injuryFrequency" class="setting-select">
              <option value="rare">Rara</option>
              <option value="low">Bassa</option>
              <option value="normal" selected>Normale</option>
              <option value="high">Alta</option>
              <option value="realistic">Realistica</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>Simulazione Partite</h5>
      <div class="setting-group">
        <div class="setting-item">
          <div class="setting-info">
            <label for="matchSpeed" class="setting-label">Velocità Predefinita</label>
            <span class="setting-description">Velocità predefinita per la simulazione delle partite</span>
          </div>
          <div class="setting-control">
            <select id="matchSpeed" class="setting-select">
              <option value="slow">Lenta</option>
              <option value="normal" selected>Normale</option>
              <option value="fast">Veloce</option>
              <option value="instant">Istantanea</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="matchDetail" class="setting-label">Livello Dettaglio</label>
            <span class="setting-description">Quantità di dettagli mostrati durante la partita</span>
          </div>
          <div class="setting-control">
            <select id="matchDetail" class="setting-select">
              <option value="minimal">Minimo</option>
              <option value="basic">Base</option>
              <option value="standard" selected>Standard</option>
              <option value="detailed">Dettagliato</option>
              <option value="comprehensive">Completo</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="commentaryLevel" class="setting-label">Livello Commento</label>
            <span class="setting-description">Quantità di commenti testuali durante la partita</span>
          </div>
          <div class="setting-control">
            <select id="commentaryLevel" class="setting-select">
              <option value="none">Nessuno</option>
              <option value="minimal">Minimo</option>
              <option value="standard" selected>Standard</option>
              <option value="detailed">Dettagliato</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="autoSubstitutions" class="setting-label">Sostituzioni Automatiche</label>
            <span class="setting-description">Permetti all'assistente di effettuare sostituzioni</span>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="autoSubstitutions">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>Progressione e Tempo</h5>
      <div class="setting-group">
        <div class="setting-item">
          <div class="setting-info">
            <label for="playerProgression" class="setting-label">Velocità Progressione</label>
            <span class="setting-description">Velocità con cui i giocatori migliorano</span>
          </div>
          <div class="setting-control">
            <select id="playerProgression" class="setting-select">
              <option value="very-slow">Molto Lenta</option>
              <option value="slow">Lenta</option>
              <option value="normal" selected>Normale</option>
              <option value="fast">Veloce</option>
              <option value="very-fast">Molto Veloce</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="youthDevelopment" class="setting-label">Sviluppo Giovani</label>
            <span class="setting-description">Velocità di sviluppo dei giovani talenti</span>
          </div>
          <div class="setting-control">
            <select id="youthDevelopment" class="setting-select">
              <option value="slow">Lento</option>
              <option value="normal" selected>Normale</option>
              <option value="fast">Veloce</option>
              <option value="accelerated">Accelerato</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="autoAdvance" class="setting-label">Avanzamento Automatico</label>
            <span class="setting-description">Avanza automaticamente al giorno successivo</span>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="autoAdvance">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="holidayMode" class="setting-label">Modalità Vacanza</label>
            <span class="setting-description">Simula automaticamente un periodo di tempo</span>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="holidayMode">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>Trasferimenti e Finanze</h5>
      <div class="setting-group">
        <div class="setting-item">
          <div class="setting-info">
            <label for="transferBudget" class="setting-label">Budget Trasferimenti</label>
            <span class="setting-description">Modifica il budget trasferimenti disponibile</span>
          </div>
          <div class="setting-control">
            <select id="transferBudget" class="setting-select">
              <option value="very-low">Molto Basso</option>
              <option value="low">Basso</option>
              <option value="normal" selected>Normale</option>
              <option value="high">Alto</option>
              <option value="very-high">Molto Alto</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="transferActivity" class="setting-label">Attività Mercato</label>
            <span class="setting-description">Livello di attività delle altre squadre sul mercato</span>
          </div>
          <div class="setting-control">
            <select id="transferActivity" class="setting-select">
              <option value="minimal">Minima</option>
              <option value="reduced">Ridotta</option>
              <option value="normal" selected>Normale</option>
              <option value="active">Attiva</option>
              <option value="frenetic">Frenetica</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="financialFairplay" class="setting-label">Fair Play Finanziario</label>
            <span class="setting-description">Applica regole di fair play finanziario</span>
          </div>
          <div class="setting-control">
            <label class="toggle-switch">
              <input type="checkbox" id="financialFairplay" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>
    </div>
    
    <div class="settings-section">
      <h5>Realismo</h5>
      <div class="setting-group">
        <div class="setting-item">
          <div class="setting-info">
            <label for="matchRealism" class="setting-label">Realismo Partite</label>
            <span class="setting-description">Livello di realismo nella simulazione delle partite</span>
          </div>
          <div class="setting-control">
            <select id="matchRealism" class="setting-select">
              <option value="arcade">Arcade</option>
              <option value="balanced" selected>Bilanciato</option>
              <option value="simulation">Simulazione</option>
              <option value="ultra-realistic">Ultra Realistico</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="playerMorale" class="setting-label">Impatto Morale</label>
            <span class="setting-description">Quanto il morale influenza le prestazioni</span>
          </div>
          <div class="setting-control">
            <select id="playerMorale" class="setting-select">
              <option value="minimal">Minimo</option>
              <option value="reduced">Ridotto</option>
              <option value="normal" selected>Normale</option>
              <option value="significant">Significativo</option>
              <option value="critical">Critico</option>
            </select>
          </div>
        </div>
        
        <div class="setting-item">
          <div class="setting-info">
            <label for="randomEvents" class="setting-label">Eventi Casuali</label>
            <span class="setting-description">Frequenza di eventi casuali nel gioco</span>
          </div>
          <div class="setting-control">
            <select id="randomEvents" class="setting-select">
              <option value="none">Nessuno</option>
              <option value="rare">Rari</option>
              <option value="normal" selected>Normali</option>
              <option value="frequent">Frequenti</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="settings-footer">
    <div class="difficulty-indicator">
      <span class="difficulty-label">Difficoltà Complessiva:</span>
      <div class="difficulty-meter">
        <div class="difficulty-fill"></div>
        <span class="difficulty-text">Normale</span>
      </div>
    </div>
    
    <div class="settings-buttons">
      <button class="button button-ghost cancel-btn">
        Annulla
      </button>
      <button class="button button-primary save-btn">
        Salva Impostazioni
      </button>
    </div>
  </div>
</div>

<style>
.gameplay-settings {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}

.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}

.settings-title {
  font-size: 18px;
  font-weight: 600;
  margin: 0;
  color: var(--text);
}

.settings-actions {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 6px 12px;
  background: var(--background);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.action-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.settings-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.settings-section {
  background: var(--background);
  border-radius: 8px;
  padding: 16px;
}

.settings-section h5 {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 16px 0;
  color: var(--text);
}

.setting-group {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 16px;
}

.setting-info {
  flex: 1;
}

.setting-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 4px;
}

.setting-description {
  font-size: 12px;
  color: var(--text-muted);
}

.setting-control {
  min-width: 150px;
}

.setting-select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--surface);
  font-size: 13px;
  cursor: pointer;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--border);
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary);
}

input:checked + .toggle-slider:before {
  transform: translateX(20px);
}

.settings-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 24px;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

.difficulty-indicator {
  display: flex;
  align-items: center;
  gap: 12px;
}

.difficulty-label {
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
}

.difficulty-meter {
  position: relative;
  width: 150px;
  height: 12px;
  background: var(--border);
  border-radius: 6px;
  overflow: hidden;
}

.difficulty-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--success), var(--warning), var(--error));
  width: 50%;
  transition: width 0.3s ease;
}

.difficulty-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 10px;
  font-weight: 600;
  color: white;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.settings-buttons {
  display: flex;
  gap: 12px;
}

.button {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.button-ghost {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
}

.button-ghost:hover {
  background: var(--background);
}

.button-primary {
  background: var(--primary);
  border: 1px solid var(--primary);
  color: white;
}

.button-primary:hover {
  background: var(--primary-dark);
}

/* Responsive */
@media (max-width: 768px) {
  .setting-item {
    flex-direction: column;
    gap: 8px;
  }
  
  .setting-control {
    width: 100%;
    min-width: auto;
  }
  
  .settings-footer {
    flex-direction: column;
    gap: 16px;
  }
  
  .difficulty-indicator {
    width: 100%;
    justify-content: space-between;
  }
  
  .settings-buttons {
    width: 100%;
    justify-content: space-between;
  }
}
</style>

<script>
class GameplaySettings {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      onChange: null,
      defaultSettings: {
        gameDifficulty: 'normal',
        aiDifficulty: 'standard',
        injuryFrequency: 'normal',
        matchSpeed: 'normal',
        matchDetail: 'standard',
        commentaryLevel: 'standard',
        autoSubstitutions: false,
        playerProgression: 'normal',
        youthDevelopment: 'normal',
        autoAdvance: false,
        holidayMode: false,
        transferBudget: 'normal',
        transferActivity: 'normal',
        financialFairplay: true,
        matchRealism: 'balanced',
        playerMorale: 'normal',
        randomEvents: 'normal'
      },
      ...options
    };
    
    this.currentSettings = { ...this.options.defaultSettings };
    this.hasChanges = false;
    
    this.init();
  }
  
  init() {
    this.loadSettings();
    this.bindEvents();
    this.updateDifficultyMeter();
  }
  
  loadSettings() {
    // In a real app, this would load from localStorage or game state
    try {
      const savedSettings = localStorage.getItem('bolt_gameplay_settings');
      if (savedSettings) {
        this.currentSettings = { ...this.currentSettings, ...JSON.parse(savedSettings) };
      }
      
      this.applySettingsToUI();
    } catch (error) {
      console.error('Error loading gameplay settings:', error);
    }
  }
  
  applySettingsToUI() {
    // Apply settings to UI controls
    Object.entries(this.currentSettings).forEach(([key, value]) => {
      const control = this.element.querySelector(`#${key}`);
      if (!control) return;
      
      if (control.type === 'checkbox') {
        control.checked = value;
      } else {
        control.value = value;
      }
    });
  }
  
  bindEvents() {
    // Checkbox inputs
    this.element.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        this.updateSetting(checkbox.id, checkbox.checked);
      });
    });
    
    // Select inputs
    this.element.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', () => {
        this.updateSetting(select.id, select.value);
      });
    });
    
    // Reset button
    this.element.querySelector('.reset-btn').addEventListener('click', () => {
      this.resetSettings();
    });
    
    // Cancel button
    this.element.querySelector('.cancel-btn').addEventListener('click', () => {
      this.cancelChanges();
    });
    
    // Save button
    this.element.querySelector('.save-btn').addEventListener('click', () => {
      this.saveSettings();
    });
  }
  
  updateSetting(key, value) {
    this.currentSettings[key] = value;
    this.hasChanges = true;
    
    // Update difficulty meter when relevant settings change
    if (['gameDifficulty', 'aiDifficulty', 'injuryFrequency', 'matchRealism', 'playerMorale'].includes(key)) {
      this.updateDifficultyMeter();
    }
  }
  
  updateDifficultyMeter() {
    const difficultyMap = {
      gameDifficulty: {
        'beginner': 0,
        'easy': 25,
        'normal': 50,
        'hard': 75,
        'expert': 100
      },
      aiDifficulty: {
        'basic': 0,
        'standard': 33,
        'advanced': 66,
        'master': 100
      },
      injuryFrequency: {
        'rare': 0,
        'low': 25,
        'normal': 50,
        'high': 75,
        'realistic': 100
      },
      matchRealism: {
        'arcade': 0,
        'balanced': 50,
        'simulation': 75,
        'ultra-realistic': 100
      },
      playerMorale: {
        'minimal': 0,
        'reduced': 25,
        'normal': 50,
        'significant': 75,
        'critical': 100
      }
    };
    
    // Calculate overall difficulty (weighted average)
    let totalWeight = 0;
    let weightedSum = 0;
    
    Object.entries(difficultyMap).forEach(([setting, valueMap]) => {
      const value = this.currentSettings[setting];
      if (value && valueMap[value] !== undefined) {
        const weight = setting === 'gameDifficulty' ? 2 : 1; // Game difficulty has double weight
        weightedSum += valueMap[value] * weight;
        totalWeight += weight;
      }
    });
    
    const overallDifficulty = totalWeight > 0 ? Math.round(weightedSum / totalWeight) : 50;
    
    // Update difficulty meter
    const difficultyFill = this.element.querySelector('.difficulty-fill');
    const difficultyText = this.element.querySelector('.difficulty-text');
    
    difficultyFill.style.width = `${overallDifficulty}%`;
    difficultyText.textContent = this.getDifficultyText(overallDifficulty);
  }
  
  getDifficultyText(difficulty) {
    if (difficulty < 20) return 'Molto Facile';
    if (difficulty < 40) return 'Facile';
    if (difficulty < 60) return 'Normale';
    if (difficulty < 80) return 'Difficile';
    return 'Molto Difficile';
  }
  
  resetSettings() {
    if (confirm('Sei sicuro di voler ripristinare tutte le impostazioni di gameplay ai valori predefiniti?')) {
      this.currentSettings = { ...this.options.defaultSettings };
      this.applySettingsToUI();
      this.updateDifficultyMeter();
      this.hasChanges = true;
      this.showSuccess('Impostazioni ripristinate ai valori predefiniti');
    }
  }
  
  cancelChanges() {
    if (this.hasChanges) {
      if (confirm('Hai modifiche non salvate. Sei sicuro di voler annullare?')) {
        this.loadSettings();
        this.hasChanges = false;
      }
    } else {
      // If no changes, just trigger the cancel event
      this.element.dispatchEvent(new CustomEvent('settingsCancel'));
    }
  }
  
  saveSettings() {
    // Save settings
    localStorage.setItem('bolt_gameplay_settings', JSON.stringify(this.currentSettings));
    
    // Call onChange callback if provided
    if (typeof this.options.onChange === 'function') {
      this.options.onChange(this.currentSettings);
    }
    
    // Dispatch settings change event
    this.element.dispatchEvent(new CustomEvent('gameplaySettingsChange', {
      detail: { settings: this.currentSettings }
    }));
    
    this.hasChanges = false;
    this.showSuccess('Impostazioni di gameplay salvate');
  }
  
  showSuccess(message) {
    window.dispatchEvent(new CustomEvent('showToast', {
      detail: { message, type: 'success' }
    }));
  }
  
  // Public methods
  getSettings() {
    return { ...this.currentSettings };
  }
  
  setSettings(settings) {
    this.currentSettings = { ...this.currentSettings, ...settings };
    this.applySettingsToUI();
    this.updateDifficultyMeter();
  }
  
  hasUnsavedChanges() {
    return this.hasChanges;
  }
  
  getDifficulty() {
    return this.currentSettings.gameDifficulty;
  }
  
  getOverallDifficulty() {
    // Return the text representation of the current difficulty
    const difficultyFill = this.element.querySelector('.difficulty-fill');
    const width = difficultyFill.style.width;
    const percentage = parseInt(width) || 50;
    return this.getDifficultyText(percentage);
  }
}

// Auto-initialize gameplay settings
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.gameplay-settings').forEach(settings => {
    if (!settings.dataset.initialized) {
      const config = JSON.parse(settings.dataset.options || '{}');
      new GameplaySettings(settings, config);
      settings.dataset.initialized = 'true';
    }
  });
});
</script>