<div class="accessibility-options">
  <div class="options-header">
    <h4 class="options-title">Accessibilit√†</h4>
    <div class="options-actions">
      <button class="action-btn preview-btn" aria-label="Anteprima impostazioni">
        üëÅÔ∏è Anteprima
      </button>
    </div>
  </div>
  
  <div class="options-section">
    <h5>Visualizzazione</h5>
    <div class="option-group">
      <div class="option-item">
        <div class="option-info">
          <label for="highContrast" class="option-label">Alto Contrasto</label>
          <span class="option-description">Aumenta il contrasto per una migliore leggibilit√†</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="highContrast">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="largeText" class="option-label">Testo Grande</label>
          <span class="option-description">Aumenta la dimensione del testo nell'interfaccia</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="largeText">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="reduceMotion" class="option-label">Riduci Movimento</label>
          <span class="option-description">Riduce o elimina le animazioni</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="reduceMotion">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div class="options-section">
    <h5>Navigazione</h5>
    <div class="option-group">
      <div class="option-item">
        <div class="option-info">
          <label for="keyboardNavigation" class="option-label">Navigazione Tastiera Migliorata</label>
          <span class="option-description">Abilita scorciatoie e navigazione avanzata da tastiera</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="keyboardNavigation" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="focusHighlight" class="option-label">Evidenzia Focus</label>
          <span class="option-description">Rende pi√π visibile l'elemento con focus</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="focusHighlight" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="simplifiedNavigation" class="option-label">Navigazione Semplificata</label>
          <span class="option-description">Semplifica la struttura di navigazione</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="simplifiedNavigation">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div class="options-section">
    <h5>Supporto Screen Reader</h5>
    <div class="option-group">
      <div class="option-item">
        <div class="option-info">
          <label for="enhancedDescriptions" class="option-label">Descrizioni Migliorate</label>
          <span class="option-description">Descrizioni pi√π dettagliate per screen reader</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="enhancedDescriptions">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="announceEvents" class="option-label">Annuncia Eventi</label>
          <span class="option-description">Annuncia automaticamente eventi importanti</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="announceEvents" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="textAlternatives" class="option-label">Alternative Testuali</label>
          <span class="option-description">Fornisce alternative testuali per contenuti visivi</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="textAlternatives" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div class="options-section">
    <h5>Daltonismo</h5>
    <div class="option-group">
      <div class="option-item">
        <div class="option-info">
          <label for="colorblindMode" class="option-label">Modalit√† Daltonismo</label>
          <span class="option-description">Ottimizza i colori per diversi tipi di daltonismo</span>
        </div>
        <div class="option-control">
          <select id="colorblindMode" class="option-select">
            <option value="none">Disattivata</option>
            <option value="protanopia">Protanopia</option>
            <option value="deuteranopia">Deuteranopia</option>
            <option value="tritanopia">Tritanopia</option>
          </select>
        </div>
      </div>
      
      <div class="option-item">
        <div class="option-info">
          <label for="usePatterns" class="option-label">Usa Pattern</label>
          <span class="option-description">Aggiunge pattern distintivi oltre ai colori</span>
        </div>
        <div class="option-control">
          <label class="toggle-switch">
            <input type="checkbox" id="usePatterns">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
  </div>
  
  <div class="options-actions">
    <button class="button button-ghost reset-options-btn">
      ‚Üª Ripristina Default
    </button>
    <button class="button button-primary apply-options-btn">
      Applica Impostazioni
    </button>
  </div>
</div>

<style>
.accessibility-options {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}

.options-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.options-title {
  font-size: 18px;
  font-weight: 600;
  margin: 0;
  color: var(--text);
}

.options-actions {
  display: flex;
  gap: 8px;
}

.action-btn {
  padding: 6px 12px;
  background: var(--background);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.action-btn:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.options-section {
  margin-bottom: 24px;
}

.options-section h5 {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 16px 0;
  color: var(--text);
  border-bottom: 1px solid var(--border);
  padding-bottom: 8px;
}

.option-group {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.option-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 16px;
}

.option-info {
  flex: 1;
}

.option-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 4px;
}

.option-description {
  font-size: 12px;
  color: var(--text-muted);
}

.option-control {
  display: flex;
  align-items: center;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 44px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: var(--border);
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 18px;
  width: 18px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary);
}

input:checked + .toggle-slider:before {
  transform: translateX(20px);
}

.option-select {
  padding: 8px 12px;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: var(--surface);
  font-size: 13px;
  min-width: 150px;
}

.options-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 24px;
}

.button {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.button-ghost {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
}

.button-ghost:hover {
  background: var(--background);
}

.button-primary {
  background: var(--primary);
  border: 1px solid var(--primary);
  color: white;
}

.button-primary:hover {
  background: var(--primary-dark);
}

/* Responsive */
@media (max-width: 768px) {
  .option-item {
    flex-direction: column;
    gap: 8px;
  }
  
  .option-control {
    align-self: flex-start;
  }
  
  .options-actions {
    flex-direction: column;
  }
  
  .button {
    width: 100%;
  }
}
</style>

<script>
class AccessibilityOptions {
  constructor(element, options = {}) {
    this.element = element;
    this.options = {
      onChange: null,
      defaultSettings: {
        highContrast: false,
        largeText: false,
        reduceMotion: false,
        keyboardNavigation: true,
        focusHighlight: true,
        simplifiedNavigation: false,
        enhancedDescriptions: false,
        announceEvents: true,
        textAlternatives: true,
        colorblindMode: 'none',
        usePatterns: false
      },
      ...options
    };
    
    this.currentSettings = { ...this.options.defaultSettings };
    this.hasChanges = false;
    
    this.init();
  }
  
  init() {
    this.loadSettings();
    this.bindEvents();
  }
  
  loadSettings() {
    // In a real app, this would load from localStorage or game state
    try {
      const savedSettings = localStorage.getItem('bolt_accessibility_settings');
      if (savedSettings) {
        this.currentSettings = { ...this.currentSettings, ...JSON.parse(savedSettings) };
      }
      
      this.applySettingsToUI();
    } catch (error) {
      console.error('Error loading accessibility settings:', error);
    }
  }
  
  applySettingsToUI() {
    // Apply settings to UI controls
    Object.entries(this.currentSettings).forEach(([key, value]) => {
      const control = this.element.querySelector(`#${key}`);
      if (!control) return;
      
      if (control.type === 'checkbox') {
        control.checked = value;
      } else {
        control.value = value;
      }
    });
  }
  
  bindEvents() {
    // Checkbox inputs
    this.element.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        this.updateSetting(checkbox.id, checkbox.checked);
      });
    });
    
    // Select inputs
    this.element.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', () => {
        this.updateSetting(select.id, select.value);
      });
    });
    
    // Preview button
    this.element.querySelector('.preview-btn').addEventListener('click', () => {
      this.previewSettings();
    });
    
    // Reset button
    this.element.querySelector('.reset-options-btn').addEventListener('click', () => {
      this.resetSettings();
    });
    
    // Apply button
    this.element.querySelector('.apply-options-btn').addEventListener('click', () => {
      this.applySettings();
    });
  }
  
  updateSetting(key, value) {
    this.currentSettings[key] = value;
    this.hasChanges = true;
  }
  
  previewSettings() {
    // Apply settings temporarily
    this.applySettingsToDocument(this.currentSettings, true);
    
    // Show preview message
    this.showSuccess('Anteprima impostazioni applicata temporaneamente');
    
    // Reset after 5 seconds
    setTimeout(() => {
      this.loadCurrentSettings();
    }, 5000);
  }
  
  resetSettings() {
    if (confirm('Sei sicuro di voler ripristinare tutte le impostazioni di accessibilit√† ai valori predefiniti?')) {
      this.currentSettings = { ...this.options.defaultSettings };
      this.applySettingsToUI();
      this.hasChanges = true;
      this.showSuccess('Impostazioni ripristinate ai valori predefiniti');
    }
  }
  
  applySettings() {
    // Save settings
    localStorage.setItem('bolt_accessibility_settings', JSON.stringify(this.currentSettings));
    
    // Apply settings to document
    this.applySettingsToDocument(this.currentSettings);
    
    // Call onChange callback if provided
    if (typeof this.options.onChange === 'function') {
      this.options.onChange(this.currentSettings);
    }
    
    // Dispatch settings change event
    this.element.dispatchEvent(new CustomEvent('accessibilitySettingsChange', {
      detail: { settings: this.currentSettings }
    }));
    
    this.hasChanges = false;
    this.showSuccess('Impostazioni di accessibilit√† applicate');
  }
  
  applySettingsToDocument(settings, isPreview = false) {
    // Apply high contrast
    document.documentElement.classList.toggle('high-contrast', settings.highContrast);
    
    // Apply large text
    document.documentElement.classList.toggle('large-text', settings.largeText);
    
    // Apply reduced motion
    document.documentElement.classList.toggle('reduce-motion', settings.reduceMotion);
    
    // Apply focus highlight
    document.documentElement.classList.toggle('focus-highlight', settings.focusHighlight);
    
    // Apply simplified navigation
    document.documentElement.classList.toggle('simplified-navigation', settings.simplifiedNavigation);
    
    // Apply colorblind mode
    document.documentElement.setAttribute('data-colorblind-mode', settings.colorblindMode);
    
    // Apply patterns for colorblind users
    document.documentElement.classList.toggle('use-patterns', settings.usePatterns);
    
    // Add preview indicator if needed
    if (isPreview) {
      this.showPreviewIndicator();
    } else {
      this.hidePreviewIndicator();
    }
  }
  
  loadCurrentSettings() {
    try {
      const savedSettings = localStorage.getItem('bolt_accessibility_settings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        this.applySettingsToDocument(settings);
      } else {
        this.applySettingsToDocument(this.options.defaultSettings);
      }
    } catch (error) {
      console.error('Error loading current settings:', error);
      this.applySettingsToDocument(this.options.defaultSettings);
    }
  }
  
  showPreviewIndicator() {
    // Create or update preview indicator
    let indicator = document.getElementById('accessibility-preview-indicator');
    
    if (!indicator) {
      indicator = document.createElement('div');
      indicator.id = 'accessibility-preview-indicator';
      indicator.style.position = 'fixed';
      indicator.style.bottom = '20px';
      indicator.style.left = '50%';
      indicator.style.transform = 'translateX(-50%)';
      indicator.style.background = 'rgba(0, 0, 0, 0.8)';
      indicator.style.color = 'white';
      indicator.style.padding = '8px 16px';
      indicator.style.borderRadius = '20px';
      indicator.style.fontSize = '12px';
      indicator.style.zIndex = '9999';
      document.body.appendChild(indicator);
    }
    
    indicator.textContent = 'Anteprima accessibilit√† (5s)';
  }
  
  hidePreviewIndicator() {
    const indicator = document.getElementById('accessibility-preview-indicator');
    if (indicator) {
      indicator.remove();
    }
  }
  
  showSuccess(message) {
    window.dispatchEvent(new CustomEvent('showToast', {
      detail: { message, type: 'success' }
    }));
  }
  
  // Public methods
  getSettings() {
    return { ...this.currentSettings };
  }
  
  setSettings(settings) {
    this.currentSettings = { ...this.currentSettings, ...settings };
    this.applySettingsToUI();
  }
  
  hasUnsavedChanges() {
    return this.hasChanges;
  }
}

// Auto-initialize accessibility options
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.accessibility-options').forEach(options => {
    if (!options.dataset.initialized) {
      const config = JSON.parse(options.dataset.options || '{}');
      new AccessibilityOptions(options, config);
      options.dataset.initialized = 'true';
    }
  });
});
</script>